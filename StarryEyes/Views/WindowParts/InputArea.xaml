<UserControl x:Class="StarryEyes.Views.WindowParts.InputArea"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Behaviors="clr-namespace:StarryEyes.Views.Messaging.Behaviors"
             xmlns:Custom="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:Custom1="http://metro.mahapps.com/winfx/xaml/shared"
             xmlns:System="clr-namespace:System;assembly=mscorlib"
             xmlns:Utils="clr-namespace:StarryEyes.Views.Utils"
             xmlns:WindowParts="clr-namespace:StarryEyes.ViewModels.WindowParts"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:l="http://schemas.livet-mvvm.net/2011/wpf"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             x:Name="userControl"
             MaxHeight="200"
             d:DataContext="{d:DesignInstance Type={x:Type WindowParts:InputAreaViewModel}}"
             d:DesignHeight="150"
             d:DesignWidth="900"
             mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Colours.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Fonts.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Controls.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <Utils:BooleanToVisibleConverter x:Key="BooleanToVisibleConverter" />
            <Utils:BooleanToInvisibleConverter x:Key="BooleanToInvisibleConverter" />
            <ControlTemplate x:Key="HashtagItemTemplate" TargetType="{x:Type ItemsControl}">
                <Grid>
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="ValidationStates">
                            <VisualState x:Name="InvalidFocused" />
                            <VisualState x:Name="InvalidUnfocused" />
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>
                    <Button Width="10"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="Click">
                                <ei:CallMethodAction MethodName="ToggleBind" TargetObject="{Binding Mode=OneWay}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <ContentPresenter Width="0"
                                          Height="26"
                                          HorizontalAlignment="Left"
                                          VerticalAlignment="Top"
                                          Content="{Binding Hashtag}" />
                    </Button>
                </Grid>
            </ControlTemplate>
            <DataTemplate x:Key="HashtagDataTemplate">
            	<Button Content="{Binding Hashtag}" HorizontalAlignment="Left" VerticalAlignment="Top" Width="Auto" VerticalContentAlignment="Stretch" Style="{DynamicResource MetroSquareUnfocusableFlatButton}"/>
            </DataTemplate>
        </ResourceDictionary>
    </UserControl.Resources>
    <i:Interaction.Triggers>
        <ei:DataTrigger Binding="{Binding IsOpening}" Value="True">
            <ei:GoToStateAction StateName="OpenState" TargetObject="{Binding ElementName=userControl}" />
        </ei:DataTrigger>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}">
            <l:OpenFileDialogInteractionMessageAction />
        </l:InteractionMessageTrigger>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}">
            <Behaviors:TaskDialogInteractionMessageAction />
        </l:InteractionMessageTrigger>
    </i:Interaction.Triggers>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="ButtonSizeControl">
                <VisualState x:Name="OpenState">
                    <Storyboard>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="itemsControl" Storyboard.TargetProperty="(FrameworkElement.Width)">
                            <EasingDoubleKeyFrame KeyTime="0" Value="48" />
                        </DoubleAnimationUsingKeyFrames>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="itemsControl" Storyboard.TargetProperty="(FrameworkElement.Height)">
                            <EasingDoubleKeyFrame KeyTime="0" Value="48" />
                        </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Button HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Style="{DynamicResource MetroSquareUnfocusableFlatButton}">
            <Button.ToolTip>
                <TextBlock><Run Text="{Binding AuthInfoScreenNames, Mode=OneWay}" />
                    <LineBreak /><Run Text="クリックすると変更することができます..." />
                </TextBlock>
            </Button.ToolTip>
            <ItemsControl x:Name="itemsControl"
                          Width="24"
                          Height="24"
                          ItemsSource="{Binding BindingAuthInfos}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="{Binding AuthInfoGridRowColumn}" Rows="{Binding AuthInfoGridRowColumn}" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Image>
                            <Image.Source>
                                <BitmapImage UriSource="{Binding ProfileImageUri}" />
                            </Image.Source>
                        </Image>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Button>
        <Grid x:Name="Default"
              Grid.Column="1"
              Margin="4,0"
              VerticalAlignment="Center"
              Visibility="{Binding IsOpening,
                                   Converter={StaticResource BooleanToInvisibleConverter}}">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseLeftButtonDown">
                    <ei:CallMethodAction MethodName="OpenInput" TargetObject="{Binding ElementName=Default}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <Border BorderThickness="1">
                <Border.BorderBrush>
                    <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ControlDarkDarkColorKey}}" />
                </Border.BorderBrush>
                <Grid Margin="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="What's happening?">
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.GrayTextColorKey}}" />
                        </TextBlock.Foreground>
                    </TextBlock>
                    <TextBlock Grid.Column="1"
                               Margin="4,0,4,0"
                               Foreground="Green"
                               Visibility="{Binding IsDraftsExisted,
                                                    Converter={StaticResource BooleanToVisibleConverter}}"><Run Text="{Binding DraftCount, Mode=OneWay}" /><Run Text=" " /><Run Text="件の下書きがあります" />
                    </TextBlock>
                    <Grid Grid.Column="2"
                          Width="{Binding MaxControlWidth}"
                          Height="12"
                          Background="DimGray"
                          Visibility="{Binding IsPostLimitPredictionEnabled,
                                               Converter={StaticResource BooleanToVisibleConverter}}">
                        <Grid.ToolTip>
                            <StackPanel Orientation="Vertical">
                                <TextBlock><Run Text="規制までのこり" /><Run Text=" " /><Run Text="{Binding RemainUpdate, Mode=OneWay}" /><Run Text=" " /><Run Text="ツイート" />
                                </TextBlock>
                                <TextBlock><Run Text="約" /><Run Text=" " /><Run Text="{Binding WindowTime, Mode=OneWay}" /><Run Text=" " /><Run Text="分で1ツイート分回復します。" />
                                </TextBlock>
                            </StackPanel>
                        </Grid.ToolTip>
                        <Grid Width="{Binding ControlWidth}"
                              VerticalAlignment="Stretch"
                              Background="Blue" />
                    </Grid>
                </Grid>
            </Border>
        </Grid>
        <Grid x:Name="Opening"
              Grid.Column="1"
              Margin="4,0">
            <Border Background="White" BorderThickness="1">
                <Border.BorderBrush>
                    <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ControlDarkDarkColorKey}}" />
                </Border.BorderBrush>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <TextBox Height="122"
                             AcceptsReturn="True"
                             BorderBrush="{x:Null}"
                             Text="{Binding InputText}"
                             TextAlignment="Justify"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto" />
                    <DockPanel Grid.Row="1"
                               Grid.ColumnSpan="3"
                               VerticalAlignment="Top">
                        <DockPanel.Background>
                            <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ControlColorKey}}" />
                        </DockPanel.Background>
                        <Button Width="80"
                                HorizontalAlignment="Left"
                                DockPanel.Dock="Right"
                                FontSize="10.667"
                                IsEnabled="{Binding CanSend}"
                                Style="{DynamicResource MetroSquareDefaultButtonStyle}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="Click">
                                    <ei:CallMethodAction MethodName="Send" TargetObject="{Binding Mode=OneWay}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Path Width="14.766"
                                  Height="12"
                                  Data="F1 M 871.18,611.587C 870.636,611.828 870.053,611.991 869.44,612.064C 870.065,611.689 870.546,611.095 870.772,610.388C 870.186,610.735 869.538,610.987 868.848,611.123C 868.295,610.534 867.508,610.166 866.637,610.166C 864.964,610.166 863.607,611.523 863.607,613.196C 863.607,613.433 863.634,613.664 863.686,613.886C 861.168,613.76 858.936,612.554 857.442,610.721C 857.181,611.168 857.032,611.689 857.032,612.244C 857.032,613.295 857.566,614.222 858.379,614.765C 857.883,614.75 857.416,614.613 857.007,614.386C 857.007,614.399 857.007,614.412 857.007,614.425C 857.007,615.892 858.051,617.117 859.437,617.395C 859.183,617.464 858.915,617.501 858.639,617.501C 858.444,617.501 858.254,617.482 858.069,617.447C 858.454,618.65 859.573,619.526 860.899,619.551C 859.862,620.363 858.556,620.848 857.136,620.848C 856.892,620.848 856.651,620.833 856.414,620.805C 857.754,621.665 859.347,622.166 861.058,622.166C 866.63,622.166 869.677,617.55 869.677,613.547C 869.677,613.416 869.674,613.285 869.668,613.155C 870.26,612.728 870.774,612.194 871.18,611.587 Z "
                                  Fill="#FFFEFEFE"
                                  Stretch="Fill" />
                        </Button>
                        <StackPanel VerticalAlignment="Top" Orientation="Horizontal">
                            <Button Width="28"
                                    Style="{DynamicResource MetroSquareUnfocusableFlatButton}"
                                    ToolTip="下書き">
                                <Path Width="15.273"
                                      Height="14"
                                      Data="F1 M 23.6818,25.5455L 20.1818,21.0909L 22.0909,21.0909L 22.0909,16L 25.9091,16L 25.9091,21.0909L 27.8182,21.0909L 24.3182,25.5455L 23.6818,25.5455 Z M 16.3636,23.6364L 18.2727,19.1818L 20.6591,19.1818L 20.6591,20.4545L 19.2273,20.4545L 17.9545,23.6364L 21.1364,23.6364C 21.1364,25.2179 22.4185,26.5 24,26.5C 25.5815,26.5 26.8636,25.2179 26.8636,23.6364L 30.0454,23.6364L 28.7727,20.4545L 27.3409,20.4545L 27.3409,19.1818L 29.7273,19.1818L 31.6364,23.6364L 31.6364,30L 16.3636,30L 16.3636,23.6364 Z "
                                      Fill="#FF000000"
                                      Stretch="Fill" />
                            </Button>
                            <Button Width="28"
                                    Style="{DynamicResource MetroSquareUnfocusableFlatButton}"
                                    ToolTip="画像の添付"
                                    Visibility="{Binding IsImageAttached,
                                                         Converter={StaticResource BooleanToInvisibleConverter}}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <ei:CallMethodAction MethodName="AttachImage" TargetObject="{Binding Mode=OneWay}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <Path Width="16.546"
                                      Height="14"
                                      Data="F1 M 15.7273,17L 32.2727,17L 32.2727,31L 15.7273,31L 15.7273,17 Z M 17,18.2727L 17,29.7273L 31,29.7273L 31,18.2727L 17,18.2727 Z M 18.2727,29.0909L 20.8182,26.5455L 22.0909,27.8182L 27.1818,22.7273L 29.0909,24.6364L 30.3636,23.3636L 30.3636,29.0909L 18.2727,29.0909 Z M 20.8182,19.5455C 20.8182,20.9513 19.6785,22.0909 18.2727,22.0909C 18.053,22.0909 17.8398,22.0631 17.6364,22.0107L 17.6364,18.9091L 20.738,18.9091C 20.7903,19.1125 20.8182,19.3257 20.8182,19.5455 Z "
                                      Fill="#FF000000"
                                      Stretch="Fill" />
                            </Button>
                            <Button Width="28"
                                    Style="{DynamicResource MetroSquareUnfocusableFlatButton}"
                                    ToolTip="位置情報の追加・更新"
                                    Visibility="{Binding IsLocationEnabled,
                                                         Converter={StaticResource BooleanToVisibleConverter}}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <ei:CallMethodAction MethodName="AttachLocation" TargetObject="{Binding Mode=OneWay}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <Path Width="6.72"
                                      Height="14"
                                      Data="F1 M 21.14,17.375L 27.86,17.375L 27.86,24.655L 21.14,31.375L 21.14,17.375 Z M 23.828,18.831L 23.828,20.175L 22.484,20.175L 22.484,21.519L 23.828,21.519L 23.828,22.863L 25.172,22.863L 25.172,21.519L 26.516,21.519L 26.516,20.175L 25.172,20.175L 25.172,18.831L 23.828,18.831 Z "
                                      Fill="#FF000000"
                                      Stretch="Fill" />
                            </Button>
                            <Button Width="28"
                                    Style="{DynamicResource MetroSquareUnfocusableFlatButton}"
                                    ToolTip="位置情報の削除"
                                    Visibility="{Binding IsLocationAttached,
                                                         Converter={StaticResource BooleanToVisibleConverter}}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <ei:CallMethodAction MethodName="DetachLocation" TargetObject="{Binding Mode=OneWay}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <Path Width="6.72"
                                      Height="14"
                                      Data="F1 M 21.14,17.375L 27.86,17.375L 27.86,24.655L 21.14,31.375L 21.14,17.375 Z M 22.3753,19.6726L 23.5496,20.847L 22.3753,22.0213L 23.3256,22.9717L 24.5,21.7973L 25.6744,22.9717L 26.6247,22.0213L 25.4503,20.847L 26.6247,19.6726L 25.6743,18.7223L 24.5,19.8966L 23.3256,18.7223L 22.3753,19.6726 Z "
                                      Fill="#FF000000"
                                      Stretch="Fill" />
                            </Button>
                            <TextBlock VerticalAlignment="Center"
                                       Text="{Binding AttachedLocation.Location}"
                                       TextWrapping="Wrap"
                                       Visibility="{Binding IsLocationAttached,
                                                            Converter={StaticResource BooleanToVisibleConverter}}" />
                        </StackPanel>
                        <DockPanel LastChildFill="False">
                            <Path Width="14"
                                  Height="14"
                                  Margin="4,0"
                                  Data="F1 M 18.8704,16.7929L 22.1351,16.7929L 30.4452,25.103C 30.9088,25.5666 30.9088,26.3183 30.4452,26.7819L 26.7819,30.4452C 26.3183,30.9088 25.5666,30.9088 25.103,30.4452L 16.7929,22.1351L 16.7929,18.8704C 16.7929,18.1779 16.7929,17.4854 17.1392,17.1392C 17.4854,16.7929 18.1779,16.7929 18.8704,16.7929 Z M 19.7608,18.5736C 19.1051,18.5736 18.5736,19.1051 18.5736,19.7608C 18.5736,20.4164 19.1051,20.9479 19.7608,20.9479C 20.4164,20.9479 20.9479,20.4164 20.9479,19.7608C 20.9479,19.1051 20.4164,18.5736 19.7608,18.5736 Z M 23.3222,20.948L 20.9479,23.3223L 25.6965,28.0709L 28.0708,25.6966L 23.3222,20.948 Z "
                                  Fill="#FF000000"
                                  Stretch="Fill"
                                  ToolTip="ロックされているハッシュタグ" />
                            <ItemsControl ItemsSource="{Binding BindingHashtags}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                            <Path Width="14"
                                  Height="14"
                                  Margin="4,0"
                                  Data="F1 M 18.8704,16.7929L 22.1351,16.7929L 30.4452,25.103C 30.9088,25.5666 30.9088,26.3183 30.4452,26.7819L 26.7819,30.4452C 26.3183,30.9088 25.5666,30.9088 25.103,30.4452L 16.7929,22.1351L 16.7929,18.8704C 16.7929,18.1779 16.7929,17.4854 17.1391,17.1392C 17.4854,16.7929 18.1779,16.7929 18.8704,16.7929 Z M 19.7608,18.5736C 19.1051,18.5736 18.5736,19.1051 18.5736,19.7608C 18.5736,20.4164 19.1051,20.9479 19.7608,20.9479C 20.4164,20.9479 20.9479,20.4164 20.9479,19.7608C 20.9479,19.1051 20.4164,18.5736 19.7608,18.5736 Z "
                                  Fill="#FF000000"
                                  Stretch="Fill"
                                  ToolTip="ロック可能なハッシュタグ" />
                            <ItemsControl ItemsSource="{Binding BindableHashtagCandidates}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                            <ItemsControl ItemsSource="{Binding DesignSource}" ItemTemplate="{DynamicResource HashtagDataTemplate}">
                            	<ItemsControl.ItemsPanel>
                            		<ItemsPanelTemplate>
                            			<StackPanel Orientation="Horizontal" />
                            		</ItemsPanelTemplate>
                            	</ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </DockPanel>
                    </DockPanel>
                    <DockPanel Grid.Column="2"
                               Width="32"
                               LastChildFill="False">
                        <Button Content="x"
                                DockPanel.Dock="Top"
                                Style="{DynamicResource MetroSquareUnfocusableFlatButton}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="Click">
                                    <ei:CallMethodAction TargetObject="{Binding Mode=OneWay}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </Button>
                        <TextBlock Margin="4"
                                   DockPanel.Dock="Bottom"
                                   Text="{Binding RemainTextCount}"
                                   TextAlignment="Right"
                                   TextWrapping="Wrap" />
                    </DockPanel>
                    <Border Grid.Column="1"
                            Width="100"
                            Height="100"
                            Margin="4,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            BorderThickness="1"
                            Visibility="{Binding IsImageAttached,
                                                 Converter={StaticResource BooleanToVisibleConverter}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="MouseLeftButtonDown">
                                <ei:CallMethodAction MethodName="OpenInput" TargetObject="{Binding Mode=OneWay}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <Border.BorderBrush>
                            <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ActiveBorderColorKey}}" />
                        </Border.BorderBrush>
                        <Image />
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
